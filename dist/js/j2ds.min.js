/**
 * j2Ds (HTML5 2D Game Engine)
 *
 * @authors Skaner, DeVinterX
 * @license zlib
 * @version 0.6.5
 */

if (global === undefined) {
    var global = window || this;
}
if (typeof define !== 'function' || !define.amd) {
    global.j2Ds = {};
    global.modules = {
        core: {},
        io: {},
        managers: {},
        nodes: {},
        utils: {}
    };
}
!function(e,t){"function"==typeof define&&define.amd?define("utils/MathUtil",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){};e.v2f=function(e,t){return{x:e,y:t}},e.v2i=function(e,t){return{x:e>>0,y:t>>0}},e.toInt=function(e){return e>>0},e.rndColor=function(t,o,i){return"rgba("+e.random(t,o)+", "+e.random(t,o)+", "+e.random(t,o)+", "+i+")"},e.random=function(t,o,i){var s=Math.floor(Math.random()*(o-t+1)+t);return i&&0==s?e.random(t,o,i):s},e.rad=function(e){return e*(Math.PI/180)},e.is4VerticesIntersect=function(t,o){var i,s;for(i=0;i<t.length;i++)for(s=0;s<o.length;s++)if(e.isLineIntersect(t[i],t[i<t.length-1?i+1:0],o[s],o[s<o.length-1?s+1:0]))return!0;return!1},e.isLineIntersect=function(e,t,o,i){var s,n,r;return 0!==(s=(t.x-e.x)*(i.y-o.y)-(i.x-o.x)*(t.y-e.y))&&(r=((i.y-o.y)*(i.x-e.x)+(o.x-i.x)*(i.y-e.y))/s,n=((e.y-t.y)*(i.x-e.x)+(t.x-e.x)*(i.y-e.y))/s,0<r&&r<1&&0<n&&n<1)},e.isPointInRect=function(t,o,i,s,n){return e.isPointInTriangle(n,t,o,i)||e.isPointInTriangle(n,i,s,t)};var t=function(e,t,o){return(e.x-o.x)*(t.y-o.y)-(t.x-o.x)*(e.y-o.y)};return e.isPointInTriangle=function(e,o,i,s){var n,r,a;return n=t(e,o,i)<0,r=t(e,i,s)<0,a=t(e,s,o)<0,n==r&&r==a},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.MathUtil=e),void 0!==global.j2Ds&&(global.modules.utils.MathUtil=e),e}),function(e,t){"function"==typeof define&&define.amd?define("utils/TextureUtil",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e};return e.prototype.createImageMap=function(e,t,o){var i=this;i.j2Ds.resources.add();var s={img:null,loaded:!1,width:e,height:t};return s.img=document.createElement("canvas"),s.context=s.img.getContext("2d"),s.img.width=s.width,s.img.height=s.height,o(s.context),s.loaded=!0,s.getAnimation=function(e,t,o,i,s){return{imageMap:this,sourceX:e,sourceY:t,sourceW:o,sourceH:i,frameCount:s-1}},i.j2Ds.resources.ok("createImageMap_"+e+"x"+t),s},e.prototype.loadImageMap=function(e){var t=this;t.j2Ds.resources.add();var o={img:null,width:0,height:0,loaded:!1};return o.img=document.createElement("img"),o.crossOrigin="anonymous",o.img.src=e,o.img.addEventListener("load",function(){o.width=o.img.width,o.height=o.img.height,o.loaded=!0,t.j2Ds.resources.ok(e)}),o.img.addEventListener("error",function(){o.width=0,o.height=0,o.loaded=!1}),o.getAnimation=function(e,t,o,i,s){return{imageMap:this,sourceX:e,sourceY:t,sourceW:o,sourceH:i,frameCount:s-1}},o},e.prototype.templates={ellipse:function(e,t,o){},fillRect:function(e,t,o){e.fillStyle=o,e.fillRect(0,0,t.x,t.y)},strokeRect:function(e,t,o,i){e.strokeStyle=o,e.lineWidth=i,e.strokeRect(0,0,t.x,t.y)},gradientL:function(e,t,o,i){var s=e.createLinearGradient(0,0,t.x,0),n=1/o.length;i||(s=e.createLinearGradient(0,0,0,t.y));for(var r=n/2,a=0;a<o.length;a+=1,r+=n)s.addColorStop(r,o[a]);e.fillStyle=s,e.fillRect(0,0,t.x,t.y)},gradientR:function(e,t,o,i,s,n,r){for(var a=e.createRadialGradient(o.x,o.y,i,s.x,s.y,n),h=1/r.length,l=h/2,d=0;d<r.length;d+=1,l+=h)a.addColorStop(l,r[d]);e.fillStyle=a,e.fillRect(0,0,t.x,t.y)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.TextureUtil=e),void 0!==global.j2Ds&&(global.modules.utils.TextureUtil=e),e}),function(e,t){"function"==typeof define&&define.amd?define("core/Dom",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e};return e.prototype.id=function(e){return document.getElementById(e)},e.prototype.name=function(e){return document.getElementsByName(e)[0]},e.prototype.tag=function(e,t){return(t||document).getElementsByTagName(e)},e.prototype.goURL=function(e){document.location.href=e},e.prototype.reloadURL=function(){document.location.href=document.location.href},e.prototype.attach=function(e,t){var o=this;this.j2Ds.events.addEvent("dom:loaded",function(t){t?o.id(t).appendChild(e):o.tag("body")[0].appendChild(e)})},e.prototype.injectJavaScript=function(e){e=(e=e.toString()).replace(/[\n\r\t]/g,";"),document.location.href="javascript: var injectFunction = (function() {setTimeout("+e+", 0);}); injectFunction();"},e.prototype.callJava=function(e){document.location.href="javacall:"+e},e.prototype.send=function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&t(o.responseText)},o.send(null)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Dom=e),void 0!==global.j2Ds&&(global.modules.core.Dom=e),e}),function(e,t){"function"==typeof define&&define.amd?define("core/Gui",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){this.nodes={}};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Gui=e),void 0!==global.j2Ds&&(global.modules.core.Gui=e),e}),function(e,t){"function"==typeof define&&define.amd?define("core/Events",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.events={"scene:deactivate":[],"scene:activate":[],"scene:beforeInit":[],"scene:afterInit":[],"scene:beforeStart":[],"scene:afterStart":[],"engine:before":[],"engine:after":[],"scene:changedGameState":[],"writeMode:keyPress":[],"dom:loaded":[]}};return e.prototype.addEvent=function(e,t,o){if(this.events[e].push({id:o||this.j2Ds.now,callback:t}),this.j2Ds.ready&&"dom:loaded"==e)return this.onEvent("dom:loaded"),!0},e.prototype.destroyEvent=function(e,t){for(var o=this,i=0,s=o.events[e].length;i<s;i+=1)o.events[e][i].id==t&&o.events[e].splice(i,1)},e.prototype.onEvent=function(e,t){for(var o=this,i=0,s=o.events[e].length;i<s;i+=1)if(o.events[e])try{o.events[e][i].callback(t||"")}catch(e){o.j2Ds.errorManager.showError(e)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Events=e),void 0!==global.j2Ds&&(global.modules.core.Events=e),e}),function(e,t){"function"==typeof define&&define.amd?define("nodes/BaseNode",["utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/MathUtil")):t(e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e){"use strict";var t,o;(o=function(e,o,i){t=e,this.visible=!0,this.alpha=1,this.pos=o,this.size=i,this.parent=!1,this.angle=0,this.layer=t.scene,this.box={offset:{x:0,y:0},size:{x:0,y:0}},t.scene.nodes.push(this)}).prototype.resizeBox=function(e,t){this.box.offset=e,this.box.size=t},o.prototype.setLayer=function(e){this.layer=e?t.layers.layer(e):t.scene},o.prototype.getLayer=function(){return this.layer},o.prototype.setVisible=function(e){this.visible=!!e},o.prototype.isVisible=function(){return this.visible},o.prototype.setAlpha=function(e){e<0&&(e=0),e>1&&(e=1),this.alpha=e},o.prototype.getAlpha=function(){return this.alpha},o.prototype.moveTo=function(t,o){o=o||1,this.move(e.v2f((t.x-this.getPosition().x)/o,(t.y-this.getPosition().y)/o))},o.prototype.setPosition=function(t){if(!t)return this.pos;this.pos=e.v2f(t.x-Math.ceil(this.size.x/2),t.y-Math.ceil(this.size.y/2))},o.prototype.move=function(e){this.pos.x+=e.x,this.pos.y+=e.y},o.prototype.getPosition=function(){return e.v2f(this.pos.x+Math.ceil(this.size.x/2),this.pos.y+Math.ceil(this.size.y/2))},o.prototype.setSize=function(e){if(!e)return this.size;this.size=e},o.prototype.getSize=function(){return this.size},o.prototype.setParent=function(e){this.parent=e},o.prototype.getDistance=function(e){return Math.ceil(Math.sqrt(Math.pow(e.getPosition().x-this.getPosition().x,2)+Math.pow(e.getPosition().y-this.getPosition().y,2)))},o.prototype.getDistanceXY=function(t){return e.v2f(Math.abs(t.getPosition().x-this.getPosition().x),Math.abs(t.getPosition().y-this.getPosition().y))},o.prototype.getBox=function(e){return{x1:e.pos.x+e.box.offset.x,x2:e.pos.x+e.box.offset.x+e.size.x+e.box.size.x,y1:e.pos.y+e.box.offset.y,y2:e.pos.y+e.box.offset.y+e.size.y+e.box.size.y}},o.prototype.getBoxVertices=function(o){void 0===o&&(o=this);var i=-e.rad(o.angle),s=o.box.offset.x+o.box.size.x/2+o.getPosition().x-t.scene.view.pos.x,n=o.box.offset.y+o.box.size.y/2+o.getPosition().y-t.scene.view.pos.y,r=this.getBox(o);return[{x:(s+(r.y1-n)*Math.sin(i)+(r.x2-s)*Math.cos(i)).toFixed(5),y:(n+(r.y1-n)*Math.cos(i)-(r.x2-s)*Math.sin(i)).toFixed(5)},{x:(s+(r.y2-n)*Math.sin(i)+(r.x2-s)*Math.cos(i)).toFixed(5),y:(n+(r.y2-n)*Math.cos(i)-(r.x2-s)*Math.sin(i)).toFixed(5)},{x:(s+(r.y2-n)*Math.sin(i)+(r.x1-s)*Math.cos(i)).toFixed(5),y:(n+(r.y2-n)*Math.cos(i)-(r.x1-s)*Math.sin(i)).toFixed(5)},{x:(s+(r.y1-n)*Math.sin(i)+(r.x1-s)*Math.cos(i)).toFixed(5),y:(n+(r.y1-n)*Math.cos(i)-(r.x1-s)*Math.sin(i)).toFixed(5)}]};var i=function(t,o){var i,s;return 0===t.angle&&0===o.angle?(i=t.getBox(t),s=t.getBox(o),!(i.y1>s.y2||i.y2<s.y1||i.x2<s.x1||i.x1>s.x2)):(i=t.getBoxVertices(t),s=t.getBoxVertices(o),!!e.is4VerticesIntersect(i,s)||(t.isPointInsideBox(i,o.getPosition())||o.isPointInsideBox(s,t.getPosition())))};return o.prototype.isPointInsideBox=function(t,o){return e.isPointInRect(t[0],t[1],t[2],t[3],o)},o.prototype.isIntersect=function(e){var t=this;if(e instanceof o)return i(t,e);if(e instanceof Array&&e.length>0&&e[0]instanceof o){for(var s=0;s<e.length;s++)if(i(t,e[s]))return!0;return!1}},o.prototype.isCollision=function(e){var t=!1;return this.getDistanceXY(e).x<this.size.x/2+e.size.x/2&&this.getDistanceXY(e).y<this.size.y/2+e.size.y/2&&(t=!0),t},o.prototype.isLookScene=function(){return!(this.pos.x>t.scene.view.pos.x+t.scene.width||this.pos.x+this.size.x<t.scene.view.pos.x||this.pos.y>t.scene.view.pos.y+t.scene.height||this.pos.y+this.size.y<t.scene.view.pos.y)},o.prototype.turn=function(e){this.angle=this.angle%360,this.angle+=e},o.prototype.setRotation=function(e){this.angle=e%360},o.prototype.getRotation=function(){return this.angle},o.prototype.rotateTo=function(e,t){t=t||1,this.setRotation(Math.atan2(e.y-this.getPosition().y,e.x-this.getPosition().x)*(180/Math.PI)/t)},o.prototype.isOutScene=function(){var e={};return this.pos.x+this.size.x>=t.scene.view.pos.x+t.scene.width?e.x=1:this.pos.x<=t.scene.view.pos.x?e.x=-1:e.x=0,this.pos.y+this.size.y>=t.scene.view.pos.y+t.scene.height?e.y=1:this.pos.y<=t.scene.view.pos.y?e.y=-1:e.y=0,e.all=e.x||e.y,e},o.prototype.moveDir=function(t){this.pos.x+=t*Math.cos(e.rad(this.angle)),this.pos.y+=t*Math.sin(e.rad(this.angle))},o.prototype.drawBox=function(){var o=this.layer.context;o.lineWidth=2,o.strokeStyle="black",this.angle&&(o.save(),o.translate(this.getPosition().x-t.scene.view.pos.x,this.getPosition().y-t.scene.view.pos.y),o.rotate(e.rad(this.angle)),o.translate(-(this.getPosition().x-t.scene.view.pos.x),-(this.getPosition().y-t.scene.view.pos.y))),o.beginPath(),o.rect(this.pos.x-t.scene.view.pos.x,this.pos.y-t.scene.view.pos.y,this.size.x,this.size.y),o.stroke(),this.angle&&(o.restore(),o.save(),o.translate(this.box.offset.x+this.box.size.x/2+this.getPosition().x-t.scene.view.pos.x,this.box.offset.y+this.box.size.y/2+this.getPosition().y-t.scene.view.pos.y),o.rotate(e.rad(this.angle)),o.translate(-(this.box.offset.x+this.box.size.x/2+this.getPosition().x-t.scene.view.pos.x),-(this.box.offset.y+this.box.size.y/2+this.getPosition().y-t.scene.view.pos.y))),o.strokeStyle="yellow",o.beginPath(),o.rect(this.box.offset.x+this.pos.x-t.scene.view.pos.x,this.box.offset.y+this.pos.y-t.scene.view.pos.y,this.box.size.x+this.size.x,this.box.size.y+this.size.y),o.stroke(),this.angle&&o.restore()},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.BaseNode=o),void 0!==global.j2Ds&&(global.modules.nodes.BaseNode=o),o}),function(e,t){"function"==typeof define&&define.amd?define("nodes/CircleNode",["nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("utils/MathUtil")):t(e.modules.nodes.BaseNode,e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,i;return i=function(i,s,n,r){o=i,e.call(this,i,s,t.v2f(2*n,2*n)),this.color=r,this.radius=n},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.draw=function(){var e=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var t=e.globalAlpha;e.globalAlpha=this.alpha}e.lineWidth=0,e.fillStyle=this.color,e.beginPath(),e.arc(this.pos.x-o.scene.view.pos.x+this.radius,this.pos.y-o.scene.view.pos.y+this.radius,this.radius,0,2*Math.PI,!0),e.stroke(),e.fill(),1!=this.alpha&&(e.globalAlpha=t)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.CircleNode=i),void 0!==global.j2Ds&&(global.modules.nodes.CircleNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/LineNode",["nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("utils/MathUtil")):t(e.modules.nodes.BaseNode,e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,i;return i=function(i,s,n,r,a,h,l,d){o=i,e.call(this,i,s,t.v2f(0,0)),this.color=a,this.points=n,this.fill=!!l||!1,this.scale=r||0,this.cFill=d,this.lineWidth=h},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.draw=function(){var e=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var t=e.globalAlpha;e.globalAlpha=this.alpha}e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.beginPath(),e.moveTo(this.pos.x-o.scene.view.pos.x,this.pos.y-o.scene.view.pos.y);for(var i=0,s=this.points.length;i<s;i+=1)e.lineTo(this.pos.x+this.points[i][0]*this.scale-o.scene.view.pos.x,this.pos.y+this.points[i][1]*this.scale-o.scene.view.pos.y);e.stroke(),this.fill&&(e.fillStyle=this.cFill,e.fill()),e.lineWidth=0,1!=this.alpha&&(e.globalAlpha=t)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.LineNode=i),void 0!==global.j2Ds&&(global.modules.nodes.LineNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/RectNode",["nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("utils/MathUtil")):t(e.modules.nodes.BaseNode,e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,i;return i=function(t,i,s,n){o=t,e.call(this,t,i,s),this.color=n},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.draw=function(){var e=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var i=e.globalAlpha;e.globalAlpha=this.alpha}this.angle&&(e.save(),e.translate(this.getPosition().x-o.scene.view.pos.x,this.getPosition().y-o.scene.view.pos.y),e.rotate(t.rad(this.angle)),e.translate(-(this.getPosition().x-o.scene.view.pos.x),-(this.getPosition().y-o.scene.view.pos.y))),e.fillStyle=this.color,e.lineWidth=0,e.fillRect(this.pos.x-o.scene.view.pos.x,this.pos.y-o.scene.view.pos.y,this.size.x,this.size.y),this.angle&&e.restore(),1!=this.alpha&&(e.globalAlpha=i)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.RectNode=i),void 0!==global.j2Ds&&(global.modules.nodes.RectNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/SpriteNode",["nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("utils/MathUtil")):t(e.modules.nodes.BaseNode,e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,i;return i=function(t,i,s,n){o=t,e.call(this,t,i,s),this.tmpSpeed=0,this.frame=0,this.animation=n,this.flip={x:!1,y:!1}},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.setFlip=function(e,t){this.flip={x:e,y:t}},i.prototype.draw=function(e){this.visible&&this.isLookScene()&&(e=e||1,this.frame>this.animation.frameCount&&(this.frame=0),this.drawFrame(this.frame+1),this.tmpSpeed>e?(this.frame+=1,this.tmpSpeed=0):this.tmpSpeed+=1)},i.prototype.drawFrame=function(e){if(!this.animation.imageMap.loaded)return err.show("Invalid ImageMap","red");var i=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var s=i.globalAlpha;i.globalAlpha=this.alpha}i.lineWidth=0,(this.angle||this.flip.x||this.flip.y)&&(i.save(),i.translate(this.getPosition().x-o.scene.view.pos.x,this.getPosition().y-o.scene.view.pos.y),i.rotate(t.rad(this.angle)),i.scale(this.flip.x?-1:1,this.flip.y?-1:1),i.translate(-(this.getPosition().x-o.scene.view.pos.x),-(this.getPosition().y-o.scene.view.pos.y))),e=e?e-1:0,i.drawImage(this.animation.imageMap.img,this.animation.sourceX+this.animation.sourceW*e,this.animation.sourceY,this.animation.sourceW,this.animation.sourceH,this.pos.x-o.scene.view.pos.x,this.pos.y-o.scene.view.pos.y,this.size.x,this.size.y),(this.angle||this.flip.x||this.flip.y)&&i.restore(),1!=this.alpha&&(i.globalAlpha=s)}},i.prototype.setAnimation=function(e){this.animation!=e&&(this.animation=e)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.SpriteNode=i),void 0!==global.j2Ds&&(global.modules.nodes.SpriteNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("nodes/TextNode",["nodes/BaseNode","utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("utils/MathUtil")):t(e.modules.nodes.BaseNode,e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o,i;return i=function(i,s,n,r,a,h,l,d){o=i,e.call(this,i,s,t.v2f(0,0)),this.vAlign="top",this.hAlign="left",this.color=a||"black",this.family=h||"serif",this.sizePx=r||20,this.box.offset.y=t.toInt(.26*this.sizePx),this.box.size.y=-t.toInt(.26*this.sizePx),this.lineWidth=l||0,this.colorL=d||"black",this.font=this.sizePx+"px "+this.family,this.fullText=n,this.maxWidth=0,this.lines=n.split("\n"),o.scene.context.font=this.font;for(var u=0,c=this.lines.length;u<c;u+=1)this.maxWidth=this.maxWidth<o.scene.context.measureText(this.lines[u]).width?o.scene.context.measureText(this.lines[u]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.setSize=function(e){this.sizePx=e,this.font=this.sizePx+"px "+this.family,o.scene.context.font=this.font,this.box.offset.y=t.toInt(.26*this.sizePx),this.box.size.y=-t.toInt(.26*this.sizePx);for(var i=0,s=this.lines.length;i<s;i+=1)this.maxWidth=this.maxWidth<o.scene.context.measureText(this.lines[i]).width?o.scene.context.measureText(this.lines[i]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx},i.prototype.getSize=function(){return this.sizePx},i.prototype.drawSimpleText=function(e,t,o,i){var s=this.layer.context;s.fillStyle=o||this.color,s.textAlign=this.hAlign,s.textBaseline=this.vAlign,s.font=this.font,s.lineWidth=this.lineWidth,s.strokeStyle=i||this.colorL;var n=e.split("\n");if(t=t||this.pos,1!=this.alpha){var r=s.globalAlpha;s.globalAlpha=this.alpha}for(var a=0,h=n.length;a<h;a+=1)this.lineWidth&&s.strokeText(n[a],t.x,t.y+this.sizePx*a),s.fillText(n[a],t.x,t.y+this.sizePx*a);1!=this.alpha&&(s.globalAlpha=r),s.lineWidth=0,s.strokeStyle="black"},i.prototype.getText=function(){return this.fullText},i.prototype.setText=function(e){this.fullText=e,this.maxWidth=0,this.lines=e.split("\n"),o.scene.context.font=this.font,this.box.offset.y=t.toInt(.26*this.sizePx),this.box.size.y=-t.toInt(.26*this.sizePx);for(var i=0,s=this.lines.length;i<s;i+=1)this.maxWidth=this.maxWidth<o.scene.context.measureText(this.lines[i]).width?o.scene.context.measureText(this.lines[i]).width:this.maxWidth;this.size.x=this.maxWidth,this.size.y=this.lines.length*this.sizePx},i.prototype.draw=function(){var e=this.layer.context;if(this.visible&&this.isLookScene()){if(1!=this.alpha){var i=e.globalAlpha;e.globalAlpha=this.alpha}this.angle&&(e.save(),e.translate(this.getPosition().x-o.scene.view.pos.x,this.getPosition().y-o.scene.view.pos.y),e.rotate(t.rad(this.angle)),e.translate(-(this.getPosition().x-o.scene.view.pos.x),-(this.getPosition().y-o.scene.view.pos.y))),e.fillStyle=this.color,e.textAlign=this.hAlign,e.textBaseline=this.vAlign,e.font=this.font,e.lineWidth=this.lineWidth,e.strokeStyle=this.colorL;for(var s=0,n=this.lines.length;s<n;s+=1)this.lineWidth&&e.strokeText(this.lines[s],this.pos.x-o.scene.view.pos.x,this.pos.y+this.sizePx*s-o.scene.view.pos.y),e.fillText(this.lines[s],this.pos.x-o.scene.view.pos.x,this.pos.y+this.sizePx*s-o.scene.view.pos.y);e.lineWidth=0,e.strokeStyle="black",this.angle&&e.restore(),1!=this.alpha&&(e.globalAlpha=i)}},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.TextNode=i),void 0!==global.j2Ds&&(global.modules.nodes.TextNode=i),i}),function(e,t){"function"==typeof define&&define.amd?define("managers/DeviceManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){return{width:parseInt(document.documentElement.clientWidth)<parseInt(screen.width)?parseInt(document.documentElement.clientWidth):parseInt(screen.width),height:parseInt(document.documentElement.clientHeight)<parseInt(screen.height)?parseInt(document.documentElement.clientHeight):parseInt(screen.height)}};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.DeviceManager=e),void 0!==global.j2Ds&&(global.modules.managers.DeviceManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/ErrorManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.mode="neverShow",this.enabled=!1};return e.prototype.init=function(e){var t=this;t.enabled=e||!0;var o=document.createElement("div");o.innerHTML="<b>RUN</b>",o.style.padding="5px",o.align="center",o.style.position="fixed",o.style.zIndex=2e4,o.style.left="0px",o.style.top=-20+t.j2Ds.getDeviceManager().height+"px",o.style.fontSize="8pt",o.style.backgroundColor="#B8FFB8",o.style.height="12px",o.style.width="50px",o.style.cursor="pointer",o.onmousedown=function(e){e.stopPropagation()},o.onclick=function(e){return e.stopPropagation(),t.show("Выполнение продолжено"),t.j2Ds.runEngine(t.j2Ds),!1},t.j2Ds.dom.attach(o),t.logListener.elems.push(o);var i=document.createElement("div");i.innerHTML="<b>PAUSE</b>",i.style.padding="5px",i.align="center",i.style.position="fixed",i.style.zIndex=2e4,i.style.left="60px",i.style.top=-20+t.j2Ds.getDeviceManager().height+"px",i.style.fontSize="8pt",i.style.backgroundColor="#FFFFBD",i.style.height="12px",i.style.width="50px",i.style.cursor="pointer",i.onmousedown=function(e){e.stopPropagation()},i.onclick=function(e){return e.stopPropagation(),t.show("Выполнение приостановлено"),t.j2Ds.stopEngine(),!1},t.j2Ds.dom.attach(i),t.logListener.elems.push(i);var s=document.createElement("div");s.innerHTML="<b>RELOAD</b>",s.style.padding="5px",s.align="center",s.style.position="fixed",s.style.zIndex=2e4,s.style.left="120px",s.style.top=-20+t.j2Ds.getDeviceManager().height+"px",s.style.fontSize="8pt",s.style.backgroundColor="#E2E2E2",s.style.color="black",s.style.height="12px",s.style.width="50px",s.style.cursor="pointer",s.onmousedown=function(e){e.stopPropagation()},s.onclick=function(e){return e.stopPropagation(),t.j2Ds.dom.reloadURL(),!1},t.j2Ds.dom.attach(s),t.logListener.elems.push(s),t.j2Ds.events.addEvent("dom:loaded",function(){t.j2Ds.window.onerror=function(e){t.show(e)}})},e.prototype.show=function(e){console.log("[j2Ds]: "+e)},e.prototype.setMode=function(e){this.mode=e,"neverShow"==e&&(this.enabled=!1)},e.prototype.debug=function(e){this.enabled&&(this.j2Ds.stopEngine(),"neverShow"!=this.mode&&this.show(e||"Точка останова достигнута"))},e.prototype.showError=function(e,t){if("neverShow"!=this.mode){for(var o=e.stack.toString(),i=0,s=(o=o.split(/\n/)).length;i<s;i+=1)if(o[i].match(/\:\d/)){o=o[i].split(/\s/);break}var n=(o=(o=o[o.length-1]).replace(/([\(\)]|[\w]+:\/\/)/g,"")).split(":"),r=n[1],a=n[2];(n=decodeURI(n[0])).match(/(<anonymous>|\bj2Ds.js)/)&&(n="<Функция-аргумент или строка>");var h='Тип ошибки: "'+e.name+'"\nСообщение: "'+e.message+'"\nФайл с ошибкой: "'+n+'"\nСтрока: '+r+", символ: "+a;t&&(h+="\nОшибка в теле функции: \n"+t.toString()),this.show(h),"stopAndShow"==this.mode&&(this.j2Ds.stopEngine(),this.show("Выполнение приостановлено"))}},e.prototype.logListener={domId:"",count:0,execLine:"",elems:[]},e.prototype.lightSyntax=function(e,t){var o=(""+e).toString();return"boolean"==t?o=o.replace(/true/gi,'<b style="color: #12D400;">$&</b>').replace(/false/gi,'<b style="color: #FF4444;">$&</b>'):"code"==t&&(o=(o=o.replace(/(this|var|typeof|new|return|if|else|for|in|while|break|do|continue|switch|case)([^a-z0-9\$_])/gi,'<span style="color: #FFC0CB;"><b>$1</b></span>$2').replace(/(function|object)/gi,'<span style="color: #FFA500;">$1</span>').replace(/(width|height|window|document|scene|j2Ds|value)/gi,'<span style="color: #59B5C0;">$1</span>').replace(/([a-z\_\$][a-z0-9_]*)\(/gi,'<span style="color: #FFCD70;">$1</span>(').replace(/(\{|\}|\]|\[|\|)/gi,'<span style="color: #FFFF00;">$1</span>').replace(/('.*?')/g,'<span style="color: #8FFF8F;">$1</span>').replace(/(#[a-z0-9]{3,8};)/,'<b style="color: red;">$1</b>').replace(/(\t)/g,"&nbsp;&nbsp;")).replace(/true/gi,'<b style="color: #12D400;">$&</b>').replace(/false/gi,'<b style="color: #FF4444;">$&</b>')),o},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ErrorManager=e),void 0!==global.j2Ds&&(global.modules.managers.ErrorManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/FpsManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.enabled=!1,this.fps=this.j2Ds.frameLimit,this.tmp_of_fps=1,this.tmp_of_time=Date.now()};return e.prototype.init=function(){var e=this;e.enabled=!0,this.j2Ds.events.addEvent("engine:after",function(){e.update()})},e.prototype.update=function(){this.enabled&&(this.tmp_of_fps+=1,this.j2Ds.now-this.tmp_of_time>=1e3&&(this.fps=this.tmp_of_fps,this.tmp_of_fps=1,this.tmp_of_time=this.j2Ds.now))},e.prototype.getFPS=function(){return this.fps<=this.j2Ds.frameLimit?this.fps:this.j2Ds.frameLimit},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.FpsManager=e),void 0!==global.j2Ds&&(global.modules.managers.FpsManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/ResourceManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.added=0,this.loaded=0,this.failed=0,this.add=function(){this.added+=1},this.ok=function(e){this.loaded+=1,this.j2Ds.errorManager.show('loaded: "'+decodeURI(e))},this.fail=function(e){this.failed+=1,this.j2Ds.errorManager.show('error load: "'+decodeURI(e))},this.show=function(){return{added:this.added,loaded:this.loaded,failed:this.failed}},this.isLoaded=function(){return this.added==this.loaded},this.getProgress=function(){return Math.ceil(this.loaded/this.added*100)}};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ResourceManager=e),void 0!==global.j2Ds&&(global.modules.managers.ResourceManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/StorageManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e,t){this.j2Ds=e,this.id=t,this.ls=!!this.j2Ds.window.localStorage&&this.j2Ds.window.localStorage,this.ls||alert('j2Ds ERROR in "createLocal('+t+')" \nОбъект "localStorage" не поддерживается.')};return e.prototype.saveNode=function(e,t){if(!this.ls)return!1;this.ls.setItem(this.id+e,JSON.stringify(t))},e.prototype.load=function(e){return!!this.ls&&this.ls.getItem(this.id+e)},e.prototype.is=function(e){return!!this.ls&&!!this.ls.getItem(this.id+e)},e.prototype.save=function(e,t){if(!this.ls)return!1;this.ls.setItem(this.id+e,t)},e.prototype.loadNode=function(e){return!!this.ls&&JSON.parse(this.ls.getItem(this.id+e))},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.StorageManager=e),void 0!==global.j2Ds&&(global.modules.managers.StorageManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/TimeManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.times={},this.insert=function(e){this.times[e]||(this.times[e]=this.j2Ds.now)},this.get=function(e){return this.times[e]}};return"object"==typeof module&&"object"==typeof module.exports&&(module.exports.TimeManager=e),void 0!==global.j2Ds&&(global.modules.managers.TimeManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/TriggerManager",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.enabled=!1,this.triggers={}};return e.prototype.add=function(e,t){var o=this,i={command:t,count:0,state:"stop",last:!1};return i.run=function(e){"job"!=this.state?o.j2Ds.now-this.last>e&&(this.last&&(this.state="job",this.count+=1,this.command()),this.last=o.j2Ds.now):this.command()},i.job=function(e){o.j2Ds.now-this.last>e&&"run"!=this.state&&(this.last&&(this.state="run",this.count+=1,this.command()),this.last=o.j2Ds.now)},i.loop=function(e){o.j2Ds.now-this.last>e&&(this.last&&(this.state="run",this.count+=1,this.command()),this.last=o.j2Ds.now)},i.reset=function(){this.count=0,this.state="stop",this.last=!1},this.triggers[e]=i,i},e.prototype.get=function(e){return this.triggers[e]},e.prototype.init=function(){this.enabled=!0},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.TriggerManager=e),void 0!==global.j2Ds&&(global.modules.managers.TriggerManager=e),e}),function(e,t){"function"==typeof define&&define.amd?define("managers/ViewManager",["utils/MathUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/MathUtil")):t(e.modules.utils.MathUtil)}("undefined"!=typeof window?window:global,function(e){"use strict";var t=function(e){this.j2Ds=e,this.views={}};return t.prototype.add=function(t,o){var i=this,s={focusNode:!1};return s.pos=o?e.v2f(o.x,o.y):e.v2f(0,0),s.setPosition=function(t){if(!t)return this;this.pos=e.v2f(t.x-i.j2Ds.scene.width/2,t.y-i.j2Ds.scene.height/2)},s.getPosition=function(){return this.pos},s.move=function(e){this.pos.x+=e.x,this.pos.y+=e.y},i.j2Ds.viewManager.views[t]=s,s},t.prototype.get=function(e){return this.j2Ds.viewManager.views[e]},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.ViewManager=t),void 0!==global.j2Ds&&(global.modules.managers.ViewManager=t),t}),function(e,t){"function"==typeof define&&define.amd?define("io/AudioHandler",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(){this.audios={},this.enabled=!1};return e.prototype.init=function(){var e=this;this.enabled=!0,e.j2Ds.events.addEvent("scene:deactivate",function(){e.deactivate()}),e.j2Ds.events.addEvent("scene:activate",function(){e.activate()})},e.prototype.load=function(e,t,o){var i=this;i.j2Ds.resources.add();for(var s=document.createElement("audio"),n=0,r=t.length;n<r;n+=1){var a=document.createElement("source");a.src=t[n],s.appendChild(a)}s.id="audio_"+e,o&&(s.volume=o<=1&&o>=0?o:1);var h={id:e,files:t,domEl:s,ready:!1,len:0,state:"stop",lock:!1,volume:s.volume,onePlay:!1};return h.domEl.addEventListener("loadeddata",function(e){h.ready=!0;var t=e.explicitOriginalTarget||e.path[0];i.j2Ds.resources.ok(t.currentSrc)}),h.domEl.addEventListener("error",function(e){h.setLock(!0)}),h.domEl.addEventListener("ended",function(){h.state="stop"}),h.play=function(e){e&&this.setLock(!1),this.lock||("play"==this.state&&(this.domEl.currentTime=0),this.domEl.play(),this.state="play")},h.loop=function(){this.lock||(this.domEl.play(),this.state="play")},h.pause=function(e){"play"==this.state&&(this.setLock(e),this.domEl.pause(),this.state="pause")},h.stop=function(e){this.domEl.pause(),this.domEl.currentTime=0,this.state="stop",e&&this.setLock(e)},h.setLock=function(e){this.lock=!!e},h.setVolume=function(e){this.domEl.volume=e<=1&&e>=0?e:1,this.volume=this.domEl.volume},h.getVolume=function(e){return this.volume},h.getState=function(e){return this.state},h.getPlayPosition=function(){return this.domEl.currentTime},h.domEl.load(),this.audios[e]=h,h},e.prototype.get=function(e){return this.audios[e]},e.prototype.pause=function(e){for(var t in this.audios)this.audios[t].pause(e)},e.prototype.stop=function(e){for(var t in this.audios)this.audios[t].stop(e)},e.prototype.play=function(e){for(var t in this.audios)this.audios[t].play(e)},e.prototype.deactivate=function(){for(var e in this.audios)"play"==this.audios[e].state&&(this.audios[e].pause(),this.audios[e].state="deactivated")},e.prototype.activate=function(){for(var e in this.audios)"deactivated"==this.audios[e].state&&this.audios[e].play()},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.AudioHandler=e),void 0!==global.j2Ds&&(global.modules.io.AudioHandler=e),e}),function(e,t){"function"==typeof define&&define.amd?define("io/InputHandler",["utils/MathUtil","nodes/BaseNode"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("utils/MathUtil"),require("nodes/BaseNode")):t(e.modules.utils.MathUtil,e.modules.nodes.BaseNode)}("undefined"!=typeof window?window:global,function(e,t){"use strict";var o=function(e){this.j2Ds=e,this.pos={x:0,y:0},this.x=0,this.y=0,this.screenPos={x:0,y:0},this.touch=!1,this.touchTap=!1,this.touchHold=!1,this.touchAutoHold=!1,this.touchCount=0,this.touchDuration=60,this.keyDown=[],this.keyPress=[],this.keyPressed=[],this.keyUp=[],this.keyUped=!1,this.mouseDown=[],this.mousePress=[],this.mousePressed=[],this.mouseUp=[],this.mouseUpped=!1,this.mouseWheel=0,this.canceled=!1,this.body=!1,this.anyKey=!1,this.anyMouse=!1,this.writeMode=!1,this.displayCursor="",this.visible=!0,this.enabled=!1};return o.prototype.mKey={LEFT:1,MIDDLE:2,RIGHT:3},o.prototype.jKey={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,NUM_0:45,NUM_1:35,NUM_2:40,NUM_3:34,NUM_4:37,NUM_5:12,NUM_6:39,NUM_7:36,NUM_8:38,NUM_9:33,NUM_MINUS:109,NUM_PLUS:107,NUM_LOCK:144,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},o.prototype.keyList=function(){var e=[];for(var t in this.jKey)e.push(t);return e},o.prototype.reset=function(){if(!this.enabled)return!1;this.keyPress=[],this.keyUp=[],this.mousePress=[],this.mouseUp=[],this.mouseWheel=0,this.touchHold=!1,this.touchTap=!1},o.prototype.isKeyDown=function(e){return void 0!==this.keyDown[this.jKey[e]]},o.prototype.isKeyPress=function(e){return void 0!==this.keyPress[this.jKey[e]]},o.prototype.isKeyUp=function(e){return void 0!==this.keyUp[this.jKey[e]]},o.prototype.getPosition=function(){return e.v2f(this.pos.x,this.pos.y)},o.prototype.getScreenPosition=function(){return e.v2f(this.screenPos.x,this.screenPos.y)},o.prototype.setWriteMode=function(e){this.writeMode=e},o.prototype.isWriteMode=function(){return this.writeMode},o.prototype.keyEvent=function(e){if(!this.enabled)return!1;if("keydown"===e.type)this.keyPressed[e.keyCode]||(this.keyPress[e.keyCode]=!0,this.keyPressed[e.keyCode]=!0),this.writeMode?this.j2Ds.events.onEvent("writeMode:keyPress",""):e.preventDefault();else if("keyup"===e.type)this.keyPressed[e.keyCode]&&(e.preventDefault(),this.keyPress[e.keyCode]=!1,this.keyPressed[e.keyCode]=!1,this.keyUp[e.keyCode]=!0,this.keyUped=!0);else if("keypress"===e.type&&this.writeMode){var t="";0!==e.which&&0!==e.charCode&&e.which>=32&&(t=String.fromCharCode(e.which)),this.j2Ds.events.onEvent("writeMode:keyPress",t)}return this.keyDown[e.keyCode]="keydown"===e.type&&!this.canceled,this.anyKey=e.keyCode,!1},o.prototype.cancel=function(e){e?this.keyDown[this.jKey[e]]=!1:(this.canceled=!0,this.keyDown=[],this.mouseDown=[],this.touchHold=!1,this.touchTap=!1,this.touch=!1,this.touchCount=0)},o.prototype.onNode=function(e){if(e instanceof t)return!(!e.layer.visible||!e.isLookScene())&&e.isPointInsideBox(e.getBoxVertices(),this.pos);if(e instanceof Array&&e.length>0&&e[0]instanceof t){for(var o=0;o<e.length;o++)if(e[o].layer.visible&&e[o].isLookScene()&&e[o].isPointInsideBox(e[o].getBoxVertices(),this.pos))return!0;return!1}},o.prototype.upd=function(){if(!this.enabled)return!1;var e=this.j2Ds.scene.offsetWidth/this.j2Ds.scene.width,t=this.j2Ds.scene.offsetHeight/this.j2Ds.scene.height;this.x=this.screenPos.x/e,this.y=this.screenPos.y/t,this.pos.x=this.j2Ds.scene.view.pos.x+this.x,this.pos.y=this.j2Ds.scene.view.pos.y+this.y,this.touchCount>0&&this.touchCount<this.touchDuration&&this.touchCount++,!this.touchHold&&this.touchCount>=this.touchDuration&&this.touchAutoHold&&(this.touchHold=!0)},o.prototype.onMove=function(e){var t=this.j2Ds.input;t.touch||(t.screenPos.x=-t.j2Ds.scene.offsetLeft+e.pageX,t.screenPos.y=-t.j2Ds.scene.offsetTop+e.pageY)},o.prototype.isMouseDown=function(e){return this.mouseDown[this.mKey[e]]},o.prototype.isMousePress=function(e){return this.mousePress[this.mKey[e]]},o.prototype.isMouseUp=function(e){return this.mouseUp[this.mKey[e]]},o.prototype.isTouch=function(){return this.touch},o.prototype.isTouchTap=function(){return this.touchTap},o.prototype.isTouchHold=function(){return this.touchHold},o.prototype.setTouchDuration=function(e){return this.touchDuration=e>0?e:60},o.prototype.isMouseWheel=function(e){return"UP"===e&&this.mouseWheel>0||"DOWN"===e&&this.mouseWheel<0},o.prototype.onMouseWheel=function(e){return!!this.enabled&&(e.preventDefault(),this.mouseWheel=e.wheelDelta?e.wheelDelta:-e.detail,!1)},o.prototype.onMouseEvent=function(e){return!!this.enabled&&(e.preventDefault(),!e.which&&e.button&&(1&e.button?e.which=1:4&e.button?e.which=2:2&e.button&&(e.which=3)),"mousedown"===e.type?this.mousePressed[e.which]||(this.mousePress[e.which]=!0,this.mousePressed[e.which]=!0):"mouseup"===e.type&&this.mousePressed[e.which]&&(this.mousePress[e.which]=!1,this.mousePressed[e.which]=!1,this.mouseUp[e.which]=!0,this.mouseUped=!0),this.mouseDown[e.which]="mousedown"===e.type&&!this.canceled,this.j2Ds.window.focus(),!1)},o.prototype.onTouchEvent=function(e){var t=this.j2Ds.input;return!!t.enabled&&(e.preventDefault(),0===t.touchCount&&t.touchCount++,t.canceled||(t.mouseDown=[],t.touch=!t.canceled),t.screenPos.x=-t.j2Ds.scene.offsetLeft+e.touches[0].pageX,t.screenPos.y=-t.j2Ds.scene.offsetTop+e.touches[0].pageY,t.j2Ds.window.focus(),!1)},o.prototype.setCursorImage=function(e){this.j2Ds.dom.tag("body")[0].style.cursor='url("'+e+'"), auto'},o.prototype.setVisible=function(e){this.visible=e,e?this.j2Ds.dom.tag("body")[0].style.cursor=this.displayCursor:(this.displayCursor=this.j2Ds.dom.tag("body")[0].style.cursor,this.j2Ds.dom.tag("body")[0].style.cursor="none")},o.prototype.isVisible=function(){return this.visible},o.prototype.init=function(){var e=this;e.enabled=!0,e.j2Ds.events.addEvent("engine:before",function(){e.upd()}),e.j2Ds.events.addEvent("engine:after",function(){e.cancel()}),e.j2Ds.events.addEvent("dom:loaded",function(){e.j2Ds.window.focus(),e.j2Ds.window.addEventListener("touchstart",e.onTouchEvent),e.j2Ds.window.addEventListener("touchmove",e.onTouchEvent),e.j2Ds.window.addEventListener("touchend",function(){e.canceled=!1,e.touchCount>=e.touchDuration?(e.touchHold=!0,e.touchTap=!1,e.touchCount=0):e.touchCount>=0&&e.touchCount<e.touchDuration&&(e.touchTap=!0,e.touchHold=!1,e.touchCount=0),e.touch=!1}),e.j2Ds.window.addEventListener("touchcancel",function(){e.canceled=!1}),e.j2Ds.window.oncontextmenu=function(){return!1},e.j2Ds.window.onselectstart=e.j2Ds.window.oncontextmenu,e.j2Ds.window.ondragstart=e.j2Ds.window.oncontextmenu,e.j2Ds.window.onmousedown=e.onMouseEvent,e.j2Ds.window.onmouseup=function(t){e.canceled=!1,e.onMouseEvent(t)},e.j2Ds.window.onmousemove=e.onMove,e.j2Ds.window.onkeydown=e.keyEvent,e.j2Ds.window.onkeyup=function(t){e.canceled=!1,e.keyEvent(t)},e.j2Ds.window.onkeypress=e.keyEvent,e.j2Ds.window.onmousewheel=e.onMouseWheel,e.j2Ds.window.addEventListener&&e.j2Ds.window.addEventListener("DOMMouseScroll",e.onMouseWheel,!1)})},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.InputHandler=o),void 0!==global.j2Ds&&(global.modules.io.InputHandler=o),o}),function(e,t){"function"==typeof define&&define.amd?define("core/Layers",[],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t():t()}("undefined"!=typeof window?window:global,function(){"use strict";var e=function(e){this.j2Ds=e,this.layersList={}};return e.prototype.layer=function(e){return this.layersList[e]},e.prototype.add=function(e,t,o){if(this.layersList[e])return!1;var i={layerName:e};return i.canvas=o?this.j2Ds.dom.id(e):document.createElement("canvas"),i.canvas.style.position=this.j2Ds.scene.stylePosition,i.canvas.id=e,i.canvas.style.zIndex=1e3+t,i.canvas.style.left=this.j2Ds.scene.offsetLeft+"px",i.canvas.style.top=this.j2Ds.scene.offsetTop+"px",i.canvas.width=this.j2Ds.scene.width,i.canvas.height=this.j2Ds.scene.height,i.width=this.j2Ds.scene.width,i.height=this.j2Ds.scene.height,i.context=i.canvas.getContext("2d"),i.context.shadowColor="rgba(0,0,0,0)",i.alpha=1,i.angle=0,i.visible=1,i.onContext=function(e){e(this.context)},i.fill=function(e){this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height)},i.setAlpha=function(e){this.canvas.style.opacity=e,this.alpha=e},i.getAlpha=function(){return this.alpha},i.setVisible=function(e){e?(this.canvas.style.display="block",this.visible=!0):(this.canvas.style.display="none",this.visible=!1)},i.isVisible=function(){return this.visible},i.setIndex=function(e){this.canvas.style.zIndex=1e3+e},i.clear=function(){this.context.clearRect(0,0,this.width,this.height)},i.clearNode=function(e){var t=this;e.isLookScene()&&this.context.clearRect(e.pos.x-t.j2Ds.scene.view.pos.x,e.pos.y-t.j2Ds.scene.view.pos.y,e.size.x,e.size.y)},i.setContextSettings=function(e){for(var t in e)void 0!==this.context[t]&&(this.context[t]=e[t])},i.clearRect=function(e,t){var o=this;this.context.clearRect(e.x-o.j2Ds.scene.view.pos.x,e.y-o.j2Ds.scene.view.pos.y,t.x,t.y)},this.layersList[e]=i,o||this.j2Ds.dom.attach(this.layersList[e].canvas),i},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Layers=e),void 0!==global.j2Ds&&(global.modules.core.Layers=e),e}),function(e,t){"function"==typeof define&&define.amd?define("core/Scene",["nodes/BaseNode","nodes/CircleNode","nodes/LineNode","nodes/RectNode","nodes/SpriteNode","nodes/TextNode","utils/TextureUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("nodes/BaseNode"),require("nodes/CircleNode"),require("nodes/LineNode"),require("nodes/RectNode"),require("nodes/SpriteNode"),require("nodes/TextNode"),require("utils/TextureUtil")):t(e.modules.nodes.BaseNode,e.modules.nodes.CircleNode,e.modules.nodes.LineNode,e.modules.nodes.RectNode,e.modules.nodes.SpriteNode,e.modules.nodes.TextNode,e.modules.utils.TextureUtil)}("undefined"!=typeof window?window:global,function(e,t,o,i,s,n,r){"use strict";var a=function(e){e=this.j2Ds=e,this.nodes=[],this.layerName="sceneNode",this.stylePosition="fixed",this.layers=e.layers,this.view=!1,this.gameStateName=!1,this.canFullScreen=!0,this.texture=new r(this.j2Ds)};return a.prototype.setView=function(e){this.view=this.j2Ds.viewManager.views[e]},a.prototype.getView=function(){return this.view},a.prototype.setAutoDraw=function(e){var t=this;e?t.j2Ds.events.addEvent("engine:after",function(){t.drawAllNodes()},"autoDraw"):t.j2Ds.events.destroyEvent("engine:after","autoDraw")},a.prototype.setAutoClear=function(e){var t=this;e?t.j2Ds.events.addEvent("engine:before",function(){t.clear()},"autoClear"):t.j2Ds.events.destroyEvent("engine:before","autoClear")},a.prototype.setGameState=function(e){this.j2Ds.gameStates.states[e].start&&this.j2Ds.gameStates.states[e].start(),this.j2Ds.gameStates.states[e].state&&this.j2Ds.setActiveEngine(this.j2Ds.gameStates.states[e].state),this.gameStateName=e,this.j2Ds.events.onEvent("scene:changedGameState")},a.prototype.getGameState=function(){return this.gameStateName},a.prototype.start=function(e,t){this.j2Ds.events.onEvent("scene:beforeStart"),this.j2Ds.gameStates.states[e].start&&this.j2Ds.gameStates.states[e].start(),this.j2Ds.gameStates.states[e]&&this.j2Ds.start(this.j2Ds.gameStates.states[e].state,t),this.j2Ds.events.onEvent("scene:afterStart")},a.prototype.fullScreen=function(e){if(this.canFullScreen){var t,o=document.createElement("canvas"),i=o.getContext("2d");if(e){this.origWidth=this.width,this.origHeight=this.height,this.width=this.j2Ds.getDeviceManager().width,this.height=this.j2Ds.getDeviceManager().height;for(var s in this.j2Ds.layers.layersList)t=this.j2Ds.layers.layersList[s],o.width=t.width,o.height=t.height,i.drawImage(t.canvas,0,0),t.canvas.width=this.width,t.canvas.height=this.height,t.width=this.width,t.height=this.height,this.offsetWidth=this.width,this.offsetHeight=this.height,t.context.drawImage(o,0,0,t.width,t.height)}else{this.width=this.origWidth,this.height=this.origHeight;for(var s in this.j2Ds.layers.layersList)(t=this.j2Ds.layers.layersList[s]).width=this.origWidth,t.height=this.origHeight,t.canvas.width=this.origWidth,t.canvas.height=this.origHeight,this.offsetWidth=this.origWidth,this.offsetHeight=this.origHeight}}},a.prototype.fullScale=function(e){if(this.canFullScreen){var t;if(e)for(var o in this.j2Ds.layers.layersList)(t=this.j2Ds.layers.layersList[o].canvas).style.width=this.j2Ds.getDeviceManager().width+"px",t.style.height=this.j2Ds.getDeviceManager().height+"px",this.offsetWidth=this.j2Ds.getDeviceManager().width,this.offsetHeight=this.j2Ds.getDeviceManager().height;else for(var o in this.j2Ds.layers.layersList)(t=this.j2Ds.layers.layersList[o].canvas).style.width=this.width+"px",t.style.height=this.height+"px",this.offsetWidth=this.width,this.offsetHeight=this.height}},a.prototype.clear=function(){this.getLayer().clear()},a.prototype.getLayer=function(){return this.j2Ds.layers.layer(this.layerName)},a.prototype.drawAllNodes=function(){for(var e=0,t=this.nodes.length;e<t;e+=1)this.nodes[e].draw&&this.nodes[e].draw()},a.prototype.init=function(e,t,o){var i=this;i.j2Ds.events.onEvent("scene:beforeInit"),i.width=e,i.height=t,i.origWidth=e,i.origHeight=t,i.offsetWidth=e,i.offsetHeight=t,i.offsetLeft=0,i.offsetTop=0,i.j2Ds.canDeactivate=0!=o,i.j2Ds.layers.add("sceneNode",0),i.context=i.j2Ds.layers.layer(i.layerName).context,i.canvas=i.j2Ds.layers.layer(i.layerName).canvas,i.visible=!0,i.cancelClear=!1,i.view=i.j2Ds.viewManager.add("sceneView"),i.j2Ds.events.onEvent("scene:afterInit"),i.j2Ds.window.onload=function(){i.j2Ds.window.focus(),i.j2Ds.window.onblur=function(){0==i.j2Ds.stopAll&&(i.j2Ds.stopEngine(),i.j2Ds.events.onEvent("scene:deactivate"))},i.j2Ds.window.onfocus=function(){1==i.j2Ds.stopAll&&(i.j2Ds.runEngine(i.j2Ds),i.j2Ds.events.onEvent("scene:activate"))};for(var e in i.j2Ds.layers.layersList)i.j2Ds.dom.attach(i.j2Ds.layers.layer(e).canvas);i.j2Ds.ready=!0,i.j2Ds.events.onEvent("dom:loaded")}},a.prototype.initCanvas=function(e,t){var o=this;o.canFullScreen=!1,o.layerName=e,o.j2Ds.events.onEvent("scene:beforeInit"),o.width=parseInt(o.j2Ds.dom.id(e).width),o.height=parseInt(o.j2Ds.dom.id(e).height),o.origWidth=o.width,o.origHeight=o.height,o.offsetWidth=parseInt(o.j2Ds.dom.id(e).offsetWidth),o.offsetHeight=parseInt(o.j2Ds.dom.id(e).offsetHeight),o.offsetLeft=parseInt(o.j2Ds.dom.id(e).offsetLeft),o.offsetTop=parseInt(o.j2Ds.dom.id(e).offsetTop),o.stylePosition="fixed"==o.j2Ds.dom.id(e).style.position?"fixed":"absolute",o.j2Ds.canDeactivate=0!=t,o.j2Ds.layers.add(e,0,1),o.context=o.j2Ds.layers.layer(e).context,o.canvas=o.j2Ds.layers.layer(e).canvas,o.visible=!0,o.cancelClear=!1,o.view=o.j2Ds.viewManager.add("sceneView"),o.j2Ds.events.onEvent("scene:afterInit"),o.j2Ds.window.onload=function(){o.j2Ds.window.focus(),o.j2Ds.window.onblur=function(){0==o.j2Ds.stopAll&&(o.j2Ds.stopEngine(),o.j2Ds.events.onEvent("scene:deactivate"))},o.j2Ds.window.onfocus=function(){1==o.j2Ds.stopAll&&(o.j2Ds.runEngine(o.j2Ds),o.j2Ds.events.onEvent("scene:activate"))};for(var e in o.j2Ds.layers.layersList)o.j2Ds.dom.attach(o.j2Ds.layers.layer(e).canvas);o.j2Ds.ready=!0,o.j2Ds.events.onEvent("dom:loaded")}},a.prototype.addBaseNode=function(t,o){return new e(this.j2Ds,t,o)},a.prototype.addCircleNode=function(e,o,i){return new t(this.j2Ds,e,o,i)},a.prototype.addLineNode=function(e,t,i,s,n,r,a){return new o(this.j2Ds,e,t,i,s,n,r,a)},a.prototype.addRectNode=function(e,t,o){return new i(this.j2Ds,e,t,o)},a.prototype.addSpriteNode=function(e,t,o){return new s(this.j2Ds,e,t,o)},a.prototype.addTextNode=function(e,t,o,i,s,r,a){return new n(this.j2Ds,e,t,o,i,s,r,a)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.Scene=a),void 0!==global.j2Ds&&(global.modules.core.Scene=a),a}),function(e,t){"function"==typeof define&&define.amd?define("j2Ds",["core/Dom","core/Gui","core/Events","core/Layers","core/Scene","io/AudioHandler","io/InputHandler","managers/DeviceManager","managers/ErrorManager","managers/FpsManager","managers/ResourceManager","managers/StorageManager","managers/TimeManager","managers/TriggerManager","managers/ViewManager","utils/MathUtil","utils/TextureUtil"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("core/Dom"),require("core/Gui"),require("core/Events"),require("core/Layers"),require("core/Scene"),require("io/AudioHandler"),require("io/InputHandler"),require("managers/DeviceManager"),require("managers/ErrorManager"),require("managers/FpsManager"),require("managers/ResourceManager"),require("managers/StorageManager"),require("managers/TimeManager"),require("managers/TriggerManager"),require("managers/ViewManager"),require("utils/MathUtil"),require("utils/TextureUtil")):t(e.modules.core.Dom,e.modules.core.Gui,e.modules.core.Events,e.modules.core.Layers,e.modules.core.Scene,e.modules.io.AudioHandler,e.modules.io.InputHandler,e.modules.managers.DeviceManager,e.modules.managers.ErrorManager,e.modules.managers.FpsManager,e.modules.managers.ResourceManager,e.modules.managers.StorageManager,e.modules.managers.TimeManager,e.modules.managers.TriggerManager,e.modules.managers.ViewManager,e.modules.utils.MathUtil,e.modules.utils.TextureUtil)}("undefined"!=typeof window?window:global,function(e,t,o,i,s,n,r,a,h,l,d,u,c,p,f,y){"use strict";var g=60,m=function(){this.now=Date.now(),this.dt=0,this.stopAll=0,this.frameLimit=60,this.sceneStartTime=0,this.sceneSkipTime=0,this.engine=function(){this.errorManager.show("Не инициализировано ни одно игровое состояние","red"),this.stopEngine()},this.ready=!1,this.window=window,this.canDeactivate=!0,this.events=new o(this),this.dom=new e(this),this.gui=new t(this),this.resources=new d(this),this.trigger=new p(this),this.timeManager=new c(this),this.deviceManager=a(),this.errorManager=new h(this),this.fpsManager=new l(this),this.input=new r(this),this.layers=new i(this),this.viewManager=new f(this),this.scene=new s(this),this.createLocal=function(e){return new u(this,e)}};m.prototype.getInfo=function(){return{name:"j2Ds",version:"0.6.4",git:"https://github.com/SkanerSoft/j2Ds",site:"http://j2ds.ru",description:"HTML5 2D Game Engine",author:"Skaner"}},m.prototype.getFPSManager=function(){return this.fpsManager.init(),this.fpsManager},m.prototype.getSceneManager=function(){return this.scene},m.prototype.getLayerManager=function(){return this.layers},m.prototype.getTextureManager=function(){return this.scene.texture},m.prototype.getAudioManager=function(){return this.audio.init(),this.audio},m.prototype.getPaintManager=function(){return this.paint},m.prototype.getIO=function(){return this.input.init(),this.input},m.prototype.getDOMManager=function(){return this.dom},m.prototype.getTriggerManager=function(){return this.trigger.init(),this.trigger},m.prototype.getMathManager=function(){return y},m.prototype.getGameStateManager=function(){return this.gameStates},m.prototype.getViewManager=function(){return this.viewManager},m.prototype.getDeviceManager=function(){return this.deviceManager},m.prototype.getErrorManager=function(){return this.errorManager.init(),this.errorManager},m.prototype.getTimeManager=function(){return this.timeManager},m.prototype.getResourceManager=function(){return this.resources},m.prototype.setWindow=function(e){this.window=e||window},m.prototype.setFrameLimit=function(e){this.frameLimit=e>0&&e<=60?e:60,g=this.frameLimit},m.prototype.setActiveEngine=function(e){this.engine="function"==typeof e?e:this.errorManager.show('Error in "GameStateManager"')},m.prototype.gameStates={states:{},add:function(e,t,o,i){var s={};s.state=t,s.start=o||!1,s.end=i||!1,this.states[e]=s}},m.prototype.start=function(e,t){this.setActiveEngine(e),this.frameLimit=t||60,this.sceneSkipTime=1e3/this.frameLimit,this.lastTime=Date.now(),this.dt=0,this.sceneStartTime=this.lastTime,this.gameEngine(this)},m.prototype.gameEngine=function(e){e.now=Date.now(),setTimeout(function(){if(!e.stopAll){e.dt=(e.now-e.lastTime)/100,e.sceneStartTime=e.now,e.dt>e.sceneSkipTime/2&&(e.dt=0),e.events.onEvent("engine:before");try{e.engine()}catch(t){e.errorManager.showError(t)}e.events.onEvent("engine:after"),e.lastTime=e.now,x(function(){e.gameEngine(e)})}},e.frameLimit<60?e.sceneSkipTime:0)};var x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/g)};return m.prototype.stopEngine=function(){this.canDeactivate&&(this.stopAll=!0)},m.prototype.runEngine=function(e){(e=e||this).canDeactivate&&e.stopAll&&(e.stopAll=!1,x(function(){e.gameEngine(e)}))},"object"==typeof module&&"object"==typeof module.exports&&(module.exports.j2Ds=m),void 0!==global.j2Ds&&(global.modules.core.j2Ds=m),void 0!==global.j2Ds&&(global.j2Ds=new m),m});
//# sourceMappingURL=j2ds.min.map
